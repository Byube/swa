<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

 <mapper namespace="com.dnk.swa.dao.SwaDao">
 
 	<insert id="insertLog" parameterType="SwaLogDto">
 		INSERT	INTO	
 				STT_LOG_INFO
							(
							STT_DATE
							,STT_CENTER
							,STT_USER
							,STT_IP
							,STT_MENU
							,STT_CONTENTS
							)
				VALUES
							(
							CURDATE()
							,#{STT_CENTER}
							,#{STT_USER}
							,#{STT_IP}
							,#{STT_MENU}
							,#{STT_CONTENTS}
							)
 	 </insert>
 
 	<select id="getMember" resultType="SwaLoginDto">
 		select	*
 		from	STT_USER_INFO
 		where	STT_ID	=	#{STT_ID}
 		and		STT_PW	=	#{STT_PW}
 		and		STT_STATUS	=	10
 	</select>
 	
 	<select id="checkLogin" parameterType="SwaLoginDto" resultType="String">
 		select	STT_PW
 		from	STT_USER_INFO
 		where	STT_ID = #{STT_ID}
 		and		STT_STATUS = 10
 	</select>
 	
 	<select id="getLogtable" parameterType="SwaLogDto" resultType="SwaLogDto">
 		select	STT_SEQ
				,STT_DATE
				,STT_CENTER
				,STT_USER
				,STT_IP
				,STT_MENU
				,STT_CONTENTS
				,rowNum
		from	(
					select	STT_SEQ
							,STT_DATE
							,STT_CENTER
							,STT_USER
							,STT_IP
							,STT_MENU
							,STT_CONTENTS
							,@row_num:=@row_num + 1 AS rowNum
					from	STT.STT_LOG_INFO
							,(SELECT @row_num := 0) rn
					where	STT_SEQ	> 0
					<if test="startDate != null and startDate !='' and endDate != null and endDate !='' ">
					and		date_format(STT_DATE,'%Y-%m-%d') between #{startDate} AND #{endDate} 
					</if>					
					
					<if test="STT_USER != null and STT_USER != '' ">
						<choose>
							<when test="STT_USER == 'all'">
							and		STT_USER != #{STT_USER}
							</when>
							<otherwise>
							and		STT_USER = #{STT_USER}	
							</otherwise>
						</choose>
					</if>
					<if test="STT_MENU != null and STT_MENU != '' ">
					<choose>
							<when test="STT_MENU == 'all'">
							and		STT_MENU != #{STT_MENU}
							</when>
							<otherwise>
							and		STT_MENU = #{STT_MENU}
							</otherwise>
						</choose>
					</if>
					order by 
							<if test="dateSort != null and dateSort !=''">
								<if test="dateSort != null and dateSort == 'dateAsc'">STT_DATE ASC,</if>
								<if test="dateSort != null and dateSort == 'dateDesc'">STT_DATE DESC,</if>
							</if>
							STT_SEQ DESC
				) urn
		where	rowNum BETWEEN #{startRow} AND #{endRow}
		order by	 rowNum
 	</select>
 	
 	<select id="getLogCount" parameterType="SwaLogDto" resultType="int">
 		select	count(STT_SEQ) as logSeq
 		from	STT_LOG_INFO
 		where	STT_SEQ > 0
 		<if test="startDate != null and startDate !='' and endDate != null and endDate !='' ">
		and		date_format(STT_DATE,'%Y-%m-%d') between #{startDate} AND #{endDate} 
		</if>					
		<if test="STT_USER != null and STT_USER != '' ">
		and		STT_USER = #{STT_USER}				
		</if>
		<if test="STT_MENU != null and STT_MENU != '' ">
		and		STT_MENU = #{STT_MENU}
		</if>
 	</select>
 	
 	<select id="getUserId" parameterType="SwaLoginDto" resultType="String">
		select	STT_ID
		from	STT_USER_INFO
		where	STT_SEQ = #{STT_SEQ}
	</select>
 	
 	
 	<select id="getUser" parameterType="SwaLoginDto" resultType="SwaLoginDto">
 		select	*
 		from	STT_USER_INFO
 		where	
 		<choose>
			<when test="STT_ID != null and STT_ID != ''">
				STT_SEQ > 0         
			</when>
			<otherwise>
				STT_NAME	!=	'admin'
			</otherwise>
		</choose>
 		and		STT_STATUS = 10
 	</select>
 	
 	<insert id="insertUser" parameterType="SwaLoginDto">
 		INSERT	INTO	
 				STT_USER_INFO
							(
							STT_NAME
							,STT_ID
							,STT_PW
							,STT_LEVEL
							,STT_DATE
							,STT_STATUS
							,STT_CENTER
							)
				VALUES
							(
							#{STT_NAME}
							,#{STT_ID}
							,'1234'
							,1
							,CURDATE()
							,10
							,#{STT_CENTER}
							)
 	 </insert>
 	
 	<update id="levelChange" parameterType="SwaLoginDto">
 		update	STT_USER_INFO
 		set		STT_LEVEL	=	#{STT_LEVEL}
 		where	STT_SEQ	=	#{STT_SEQ}
 	</update>
 	
 	<update id="deleteUser" parameterType="SwaLoginDto">
 		update	STT_USER_INFO
 		set		STT_STATUS	=	#{STT_STATUS}
 		where	STT_SEQ	=	#{STT_SEQ}
 	</update>
 	
 	<update id="resetPw" parameterType="SwaLoginDto">
 		update	STT_USER_INFO
 		set		STT_PW	=	#{STT_PW}
 		where	STT_SEQ	=	#{STT_SEQ}
 	</update>

	<select id="checkIdok" parameterType="SwaLoginDto" resultType="int">
		select	COUNT(*)
		from	STT_USER_INFO
		where	STT_ID = #{STT_ID}
	</select>
	
	<select id="getMin" resultType="String">
		select	min(date_format(STT_DATE,'%Y-%m-%d'))
		from	STT_LOG_INFO
	</select>
	
	<select id="getMenu" resultType="SwaLogDto">
		select		STT_MENU
		from		STT_LOG_INFO
		group by	STT_MENU
	</select>
 	
 	
 	
 </mapper>